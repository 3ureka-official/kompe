# Kompe - TikTokコンテストプラットフォーム要件定義書 v2.0

## 1. プロジェクト概要

### 1.1 サービス概要

**Kompe（コンペ）** は、ブランドがTikTokでの動画コンテストを開催し、クリエイターが賞金を獲得できるプラットフォームです。

### 1.2 ビジネスモデル

- コンテスト開催時にブランドから賞金総額の10%を手数料として徴収
- 手数料は返金不可

### 1.3 主要指標（KPI）

- α版：クリエイター登録数 30名
- 月間コンテスト開催数
- 総賞金流通額

## 2. ユーザー定義

### 2.1 ブランド（コンテスト主催者）

- **役割**: コンテストを企画・開催し、賞金を提供
- **ニーズ**: 効果的なUGC収集、ブランド認知向上、具体的な動画イメージの共有

### 2.2 クリエイター（参加者）

- **役割**: コンテストに動画を投稿し、賞金を獲得
- **ニーズ**: 収益機会、明確な制作指針、公平な評価

## 3. 機能要件

### 3.1 認証機能

#### 3.1.1 ブランド

- GoogleアカウントorAppleでログイン
- プロフィール管理（ブランド名、アイコン）

#### 3.1.2 クリエイター

- TikTokアカウントでログイン（Firebase Auth経由）
- プロフィール自動取得（ユーザー名、アイコン）
- 銀行口座情報登録（KYC簡易版）

### 3.2 コンテスト管理機能

#### 3.2.1 コンテスト作成（ブランド）

```
必須項目：
- タイトル（最大100文字）
- 説明文（最大1000文字）
- カテゴリ（選択式）
- 動画の要望（リッチテキストエディタ）
- 開催期間（最短7日、最長30日）
- 評価基準（再生数 or エンゲージメント率）
- 賞金設定（順位ごとの金額）
- 規約同意

オプション項目：
- イメージ動画URL（リッチテキスト内に埋め込み可）
- 素材アップロード（画像、PDF、動画、最大10ファイル、合計100MB）

機能：
- 下書き保存
- プレビュー
- 公開/非公開切り替え
- 編集履歴
```

#### 3.2.2 カテゴリマスタ

```
- 美容・コスメ
- ファッション
- 食品・飲料
- テクノロジー
- ゲーム
- 音楽
- スポーツ
- 旅行
- ライフスタイル
- その他
```

#### 3.2.3 リッチテキストエディタ仕様

```
使用可能な機能：
- 見出し（H2, H3）
- 文字装飾（太字、斜体、下線、取り消し線）
- 文字色・背景色
- 箇条書き（番号あり/なし）
- リンク挿入

動画埋め込み仕様：
- TikTok: 通常の共有URLを自動でembed形式に変換
- プレビュー表示対応
```

#### 3.2.4 素材管理

```
アップロード可能ファイル：
- 画像: JPG, PNG, GIF, WebP（最大20MB/ファイル）
- 動画: MP4, MOV（最大20MB/ファイル）
- ドキュメント: PDF（最大20MB/ファイル）

機能：
- ドラッグ&ドロップアップロード
- 一括アップロード
- プレビュー表示
- ファイル名編集
- 削除（使用中の素材は削除不可）
- ダウンロード許可設定
```

#### 3.2.5 応募機能（クリエイター）

```
制限事項：
- 1人1動画まで
- 応募期間内に投稿された動画のみ

応募フロー：
1. コンテスト詳細確認
2. 素材ダウンロード（許可されている場合）
3. TikTok動画URL入力
4. 投稿者確認（URL内のユーザー名と一致）
5. 規約同意
6. 応募完了
```

### 3.3 データ取得・集計機能

#### 3.3.1 TikTok API連携

```
取得データ：
- 再生数（view_count）
- いいね数（like_count）
- コメント数（comment_count）
- シェア数（share_count）
- 投稿日時
- 説明文
- サムネイル画像URL

更新頻度：
- 上位5名：30分ごと
- 6-15位：1時間ごと
- 16位以下：2時間ごと
- 最終日：全員30分ごと

API制限対策：
- 1分600リクエスト制限の管理
- キューシステムによる分散処理
```

#### 3.3.2 ランキング計算

```
評価基準：
1. 再生数順：view_count の降順
2. エンゲージメント率順：
   (like_count + comment_count + share_count) / view_count * 100

同点処理：
- 同点の場合は応募が早い順
- コンテスト終了後、ブランドが最終調整可能
```

### 3.4 決済機能

#### 3.4.1 集金（Stripe）

```
フロー：
1. コンテスト作成時に賞金総額を計算
2. 手数料10%を加算した金額を請求
3. カード決済 or 銀行振込
4. 決済完了後、コンテスト公開

対応決済：
- クレジットカード（Visa, Mastercard, Amex, JCB）
- 銀行振込（請求書発行）
```

#### 3.4.2 支払い

```
フロー：
1. コンテスト終了
2. ブランドが最終順位確認・調整（3日以内）
3. 支払い承認
4. クリエイターの登録口座へ振込（手動、5営業日以内）
5. 振込完了をシステムに記録

未成年対応：
- 保護者の同意書必須
- 保護者名義の口座登録可
```

### 3.5 通知機能

- コンテスト開始通知（メール）
- 応募受付通知（メール）
- コンテスト終了通知（メール）
- 入賞通知（メール）
- 振込完了通知（メール）

### 3.6 管理機能（α版では最小限）

- ユーザー一覧・検索
- コンテスト一覧・検索
- 応募動画の不適切フラグ管理
- 利用規約の更新

## 4. 非機能要件

### 4.1 パフォーマンス

- ページロード：3秒以内（3G回線）
- ランキング更新：リアルタイム表示
- 同時接続：100ユーザー
- ファイルアップロード：50MBを2分以内

### 4.2 セキュリティ

- HTTPS必須
- Firebase Auth による認証
- Supabase RLS によるデータアクセス制御
- XSS/CSRF対策
- ファイルアップロードのウイルススキャン（将来実装）
- 素材の直リンク防止（署名付きURL）

### 4.3 可用性

- 稼働率：99%（月間7時間程度の停止許容）
- バックアップ：日次自動バックアップ
- 災害復旧：24時間以内

### 4.4 運用性

- エラー監視：Sentry
- アクセス解析：Google Analytics
- ログ管理：Supabase Logs
- 監視：Uptime Robot

## 5. 技術スタック

### 5.1 フロントエンド

- Next.js 14 (App Router)
- TypeScript
- Tailwind CSS
- shadcn
- React Query（TanStack Query）
- Tiptap（リッチテキストエディタ）

### 5.2 バックエンド

- Supabase (PostgreSQL)
- Edge Functions（必要に応じて）
- Supabase Storage（素材管理）

### 5.3 認証

- Firebase Auth（TikTok OAuth）
- Supabase Auth（メール認証）

### 5.4 外部API

- TikTok API v2
- Stripe API
- SendGrid（メール送信）

### 5.5 インフラ

- Vercel（フロントエンド）
- Supabase Cloud（DB・ストレージ）
- Cloudflare（CDN）

## 6. データベース設計

## 7. 画面遷移

### 7.1 ブランド側

```
1. ランディングページ
   ├→ 新規登録
   │   ├→ メール認証
   │   └→ プロフィール設定
   └→ ログイン
       └→ ダッシュボード
           ├→ コンテスト一覧
           ├→ コンテスト作成（ウィザード形式）
           │   ├→ 基本情報入力
           │   ├→ 動画要望作成
           │   ├→ 素材アップロード
           │   ├→ 賞金設定
           │   ├→ 確認・決済
           │   └→ 公開
           └→ コンテスト詳細
               ├→ 応募一覧
               ├→ ランキング
               ├→ 編集
               └→ 順位確定・支払い承認
```

### 7.2 クリエイター側

```
1. ランディングページ（コンテスト一覧）
   ├→ カテゴリ絞り込み
   ├→ コンテスト詳細
   │   ├→ 要望確認
   │   ├→ 素材ダウンロード
   │   └→ 応募（要ログイン）
   └→ TikTokログイン
       └→ マイページ
           ├→ プロフィール編集
           ├→ 銀行口座登録
           ├→ 応募履歴
           └→ 獲得賞金履歴
```

## 8. 開発フェーズ

### Phase 1：クリエイターフロントエンド（2週間）

- プロジェクトセットアップ
- UIコンポーネント作成
- コンテスト一覧・詳細画面
- Firebase Auth統合
- 応募フロー
- マイページ

### Phase 2：クリエイターバックエンド（2週間）

- Supabase設定
- 認証システム
- コンテストAPI
- 応募API
- TikTok API統合
- ランキングシステム

### Phase 3：ブランドフロントエンド（2週間）

- 管理画面レイアウト
- 認証フロー
- コンテスト一覧・管理
- 作成ウィザード
- リッチテキストエディタ
- 素材アップロード

### Phase 4：ブランドバックエンド（2週間）

- 認証・権限管理
- コンテスト管理API
- ファイルアップロード
- Stripe統合
- 分析・レポート
- 通知システム

### Phase 5：テスト・改善（2週間）

- 統合テスト
- セキュリティテスト
- パフォーマンス最適化
- バグ修正
- ドキュメント作成

## 9. セキュリティ要件

### 9.1 認証・認可

- 二要素認証（将来実装）
- セッションタイムアウト（24時間）
- 同時ログイン制限

### 9.2 データ保護

- 個人情報の暗号化
- 銀行口座情報の暗号化保存
- APIキーの環境変数管理

### 9.3 コンテンツ保護

- 素材への直リンク防止
- 署名付きURL（有効期限付き）
- CORS設定

## 10. リスクと対策

| リスク           | 影響度 | 発生確率 | 対策                           |
| ---------------- | ------ | -------- | ------------------------------ |
| TikTok API制限   | 高     | 中       | キャッシュ活用、段階的更新     |
| 不正動画・BOT    | 中     | 中       | 応募時の自動チェック、通報機能 |
| 著作権侵害       | 高     | 低       | 利用規約、DMCA対応フロー       |
| 決済トラブル     | 高     | 低       | Stripe標準フロー、手動確認     |
| 素材の不正利用   | 中     | 中       | 透かし機能、利用規約での制限   |
| スケーラビリティ | 中     | 低       | 初期は100人想定、段階的拡張    |

## 11. 成功指標（α版）

### 11.1 定量指標

- クリエイター登録数：30名以上
- コンテスト開催数：3件以上
- 応募動画数：平均10本/コンテスト
- システム稼働率：99%以上

### 11.2 定性指標

- ブランドからの使いやすさ評価
- クリエイターの満足度
- 動画品質の向上

## 12. 将来的な拡張

### 12.1 機能拡張

- Instagram Reels対応
- YouTube Shorts対応
- AIによる動画内容自動チェック
- 詳細な分析レポート機能
- 自動字幕生成
- 多言語対応

### 12.2 ビジネス拡張

- 月額プラン（手数料割引）
- 企業向けAPI提供
- インフルエンサーマッチング
- 動画制作支援ツール

---

## 変更履歴

### v2.0 (2024-01-XX)

- コンテスト作成項目を更新（カテゴリ、動画の要望、素材アップロード追加）
- 必須ハッシュタグを削除
- リッチテキストエディタの仕様を詳細化
- 開発フェーズをクリエイター優先に変更

### v1.0 (2024-01-XX)

- 初版作成
